---
title: "Getting started with Hadeda"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting started with Hadeda}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE
)
```

Hadeda provides tidyverse-friendly wrappers around the Hedera REST and gRPC
APIs. This vignette demonstrates how to initialise your environment, configure
transport credentials, and create your first account on the Hedera testnet.

## Install and load Hadeda

The package uses `renv` to manage dependencies for contributors. End users can
install Hadeda directly from the Git repository until a CRAN release becomes
available:

```{r}
# install.packages("pak")
pak::pak("hadeda-r/hadeda")

library(hadeda)
```

The helper functions return tibbles and respect tidyverse semantics, so we will
also load `dplyr` in examples:

```{r}
library(dplyr)
```

## Configure transports

The Hedera mirror node REST API and gRPC services both require host
configuration. Hadeda ships sensible defaults for the public testnet, but you
can override them to target providers such as Hashio or private nodes. REST-only
workflows require a base URL and optional headers:

```{r}
mirror <- hadeda_config(
  network = "testnet",
  rest = list(
    base_url = "https://testnet.hashio.io/api/v1",
    headers = list(`X-API-Key` = Sys.getenv("HASHIO_API_KEY"))
  ),
  default_transport = "rest"
)
```

For gRPC interactions you will typically provide a channel constructor and
transaction signing handler in `config$grpc`. The package does not prescribe a single signing strategy; instead, it works with closures that return signed
transactions.

```{r}
grpc_handler <- list(
  operator_account_id = Sys.getenv("HADEDA_OPERATOR_ID"),
  channel = function() {
    stop("Configure a gRPC channel factory for your environment")
  },
  sign_transaction = function(tx_bytes) {
    stop("Provide a signing routine that returns raw signature bytes")
  }
)

default <- hadeda_config(network = "testnet")
default$grpc <- modifyList(default$grpc, grpc_handler)
```

See the `?hadeda_config` documentation for more detail on the configuration
structure and expected handler interfaces.

## Create an account

Mirror node REST APIs are read-only, so account creation always flows through
the CryptoService gRPC helper. Configure a handler that delegates to your
preferred SDK client and then call `crypto_create_account()` with the desired
metadata:

> **Security tip**  
> Avoid committing keys or keeping them in plain-text files. Prefer storing them in an OS-backed vault via the
> [`keyring`](https://cran.r-project.org/package=keyring) package (`keyring::key_set_with_value()` /
> `keyring::key_get()`) and inject them into the session with `Sys.setenv()` or `withr::with_envvar()` for automation.
> If you need an interactive prompt inside R, pair `keyring` with [`askpass`](https://cran.r-project.org/package=askpass).

```{r}
created <- crypto_create_account(
  default,
  public_key = Sys.getenv("HADEDA_PUBLIC_KEY"),
  initial_balance = 10,
  wait_for_record = TRUE
)

created |> tidyr::unnest_wider(receipt)
```

## Next steps

With a funded account you can explore other Hadeda vignettes covering topic
messaging, transaction queries, token management, and smart contract
interaction. Each vignette builds on the configuration patterns introduced here
so you can adapt them to mainnet or private deployments.
